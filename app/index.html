<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script id="shader-fs" type="x-shader/x-fragment">
        precision highp float;

        const int MAX_DIRECTIONAL_LIGHTS = 10;

        varying vec3 normal;
        varying vec4 position;

        struct Material {
            vec3 color;
        };

        struct Light {
            vec3 diffuse;
        };

        struct DirectionalLight {
            vec3 diffuseColor;
            vec3 direction;
        };

        struct PointLight {
            vec3 diffuseColor;
            vec3 position;
            float constantAttenuation;
            float linearAttenuation;
            float exponentAttenuation;
        };

        uniform Material material;
        uniform DirectionalLight directionalLight;
        uniform PointLight pointLight;

        vec4 getDirectionalLightColor(const DirectionalLight directionalLight, vec3 normal) {
            float diffuse = max(0.0, dot(normal, -directionalLight.direction));
            return vec4(diffuse * directionalLight.diffuseColor, 1.0);
        }

        vec4 getPointLightColor(const PointLight pointLight, vec3 position, vec3 normal) {
            vec3 positionToLight = position - pointLight.position;
            float distance = length(positionToLight);
            positionToLight = normalize(positionToLight);

            float diffuse = max(0.0, dot(normal, -positionToLight));
            float attenuation = pointLight.constantAttenuation + pointLight.linearAttenuation * distance + pointLight.exponentAttenuation * distance * distance;

            return vec4(pointLight.diffuseColor, 1.0) * diffuse / attenuation;
        }

        void main(void) {
            vec4 color = getDirectionalLightColor(directionalLight, normal);
            color += getPointLightColor(pointLight, position.xyz, normal);
            gl_FragColor = vec4(material.color, 1.0) * color;
        }
    </script>

    <script id="shader-vs" type="x-shader/x-vertex">
        attribute vec3 vertexPosition;
        attribute vec3 vertexNormal;
        attribute vec4 vertexColor;

        uniform mat4 modelMatrix;
        uniform mat4 viewMatrix;
        uniform mat4 projectionMatrix;
        uniform mat3 normalMatrix;

        varying vec3 normal;
        varying vec4 position;
        varying vec4 eye;

        void main(void) {
            normal = normalMatrix * vertexNormal;
            position = modelMatrix * vec4(vertexPosition, 1.0);
            eye = viewMatrix * position;
            gl_Position = projectionMatrix * eye;
        }
    </script>
    <script type="text/javascript" src="../lib/jquery-2.1.0.min.js"></script>
    <script type="text/javascript" src="../dist/webgl3d.js"></script>
    <script type="text/javascript" src="app.js"></script>
</head>
<style>
    body {
        margin: 0;
    }
</style>
<body onload="main()">
<canvas id="gl-canvas" width="600" height="400">
    Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
</canvas>
<div>
    Position: <span id="position"></span><br>
    Direction: <span id="direction"></span><br>
    Up: <span id="up"></span><br>
    View matrix: <span id="viewMatrix"></span><br>
    Pitch angle: <span id="pitchAngle"></span><br>
    Yaw angle: <span id="yawAngle"></span><br>
</div>
</body>
</html>